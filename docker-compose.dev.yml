services:
  rag_backend:
    command: sh -c "npm install && npm run dev"
    environment:
      - RAG_FEEDER_PYTHON=/opt/venv/bin/python
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - CHOKIDAR_USEPOLLING=1
    volumes:
      - ./backend:/usr/src/app
      - rag_backend_node_modules:/usr/src/app/node_modules
      - ./dl_lit:/usr/src/app/dl_lit
      - ./dl_lit_project:/usr/src/app/dl_lit_project
      - rag_feeder_uploads:/usr/src/app/uploads

  rag_feeder:
    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port 5175"
    environment:
      - NODE_ENV=development
      - NPM_CONFIG_PRODUCTION=false
      - VITE_API_BASE=http://localhost:4000
      - CHOKIDAR_USEPOLLING=1
    volumes:
      - ./frontend:/app
      - rag_feeder_node_modules:/app/node_modules

volumes:
  rag_backend_node_modules:
  rag_feeder_node_modules:
